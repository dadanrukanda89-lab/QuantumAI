<!-- frontend/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>QuantumAI v6 Sulung Workflow — Live</title>
<style>
  :root{--cyan:#00e5ff;--purple:#9b59b6;--blue:#3498db;--orange:#e67e22;--green:#2ecc71;--red:#e74c3c}
  html,body{height:100%;margin:0;background:#02061a;color:var(--cyan);font-family:Inter,Segoe UI,Roboto,Arial,system-ui;overflow:hidden}
  .grid{position:absolute;inset:0;background-image:
    linear-gradient(rgba(0,229,255,0.04) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,229,255,0.04) 1px, transparent 1px);background-size:26px 26px}
  .glow-core{position:absolute;left:50%;top:48%;width:420px;height:420px;border-radius:50%;
    transform:translate(-50%,-50%);background:radial-gradient(circle,#00e5ff33 0%,transparent 60%);filter:blur(8px)}
  .module{position:absolute;width:180px;height:110px;border-radius:12px;border:2px solid var(--cyan);
    display:flex;align-items:center;justify-content:center;background:linear-gradient(0deg,rgba(0,0,0,0.25),transparent);box-shadow:0 6px 18px rgba(0,0,0,0.6)}
  .ai-core{left:50%;top:50%;transform:translate(-50%,-50%);box-shadow:0 0 40px var(--cyan)}
  .chat-hub{right:36px;bottom:140px;border-color:var(--purple);box-shadow:0 0 20px var(--purple)}
  .radar{left:30px;top:36px;border-color:var(--blue);box-shadow:0 0 20px var(--blue)}
  .risk{right:30px;top:36px;border-color:var(--orange);box-shadow:0 0 20px var(--orange)}
  .storage{left:30px;bottom:36px;border-color:var(--green);box-shadow:0 0 18px var(--green)}
  .control{left:50%;bottom:36px;transform:translateX(-50%);border-color:var(--red);box-shadow:0 0 18px var(--red);cursor:pointer}
  .module h3{margin:0;color:var(--cyan);font-weight:600}
  .label-small{position:absolute;left:14px;top:12px;color:var(--cyan);opacity:.8;font-weight:600}
  /* Chart */
  .chart {position:absolute;left:50%;transform:translateX(-50%);bottom:-260px;width:86%;height:240px;border-radius:12px;border:2px solid var(--cyan);
    background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.45));box-shadow:0 6px 30px rgba(0,0,0,0.6);transition:bottom .55s ease;z-index:6}
  .chart.open{bottom:108px}
  /* Chat box (bottom center) */
  .chat-window{position:absolute;left:50%;transform:translateX(-50%);bottom:18px;width:88%;max-width:1100px;height:160px;border-radius:12px;border:2px solid rgba(0,0,0,0.2);
    background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.4));box-shadow:0 10px 40px rgba(0,0,0,0.6);z-index:7;display:flex;flex-direction:column}
  .chat-log{flex:1;padding:12px;overflow:auto;color:#d6faff;font-size:13px}
  .chat-input-wrap{display:flex;padding:10px;border-top:1px solid rgba(255,255,255,0.03)}
  .chat-input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--cyan);outline:none}
  .chat-send{margin-left:8px;padding:8px 12px;border-radius:8px;border:none;background:var(--cyan);color:#001;cursor:pointer}
  /* radar canvas */
  #radarCanvas{position:absolute;left:90px;top:110px;z-index:4;pointer-events:none}
  /* responsive tweaks */
  @media(max-width:420px){.module{width:150px;height:90px}.chart{height:200px}.chat-window{height:140px}}
</style>
</head>
<body>
  <div class="label-small">drukanda</div>
  <div class="grid"></div>
  <div class="glow-core"></div>

  <div class="module ai-core" id="aiCore"><h3>AI Core</h3></div>
  <div class="module chat-hub" id="chatHub"><h3>Chat Hub</h3></div>
  <div class="module radar" id="radarBox"><h3>Radar Momentum</h3></div>
  <div class="module risk" id="riskBox"><h3>Risk Engine</h3></div>
  <div class="module storage" id="storageBox"><h3>Secure Storage</h3></div>
  <div class="module control" id="controlBox" onclick="toggleChart()"><h3>Control Panel</h3></div>

  <canvas id="radarCanvas" width="380" height="380"></canvas>

  <div class="chart" id="chartBox"><canvas id="chartCanvas" width="1400" height="240"></canvas></div>

  <div class="chat-window" id="chatWindow" style="display:block;">
    <div class="chat-log" id="chatLog">
      <div><b style="color:#9be3ff">[SYSTEM]</b> QuantumAI core online — ready.</div>
    </div>
    <div class="chat-input-wrap">
      <input class="chat-input" id="chatInput" placeholder="Type / ask (e.g. buy, sell, scan)..." />
      <button class="chat-send" onclick="sendChat()">Send</button>
    </div>
  </div>

<script>
/* =========== CONFIG =========== */
const backendURL = "https://REPLACE_WITH_YOUR_BACKEND.koyeb.app"; // <-- ganti setelah deploy backend

/* =========== UI HELPERS =========== */
function q(id){return document.getElementById(id)}
function logChat(lineHtml){ const log=q('chatLog'); log.insertAdjacentHTML('beforeend',lineHtml); log.scrollTop = log.scrollHeight; }

/* =========== CHART (canvas draw) =========== */
const chartCanvas = q('chartCanvas').getContext('2d');
function drawChart(values){
  const w = q('chartCanvas').width, h = q('chartCanvas').height;
  chartCanvas.clearRect(0,0,w,h);
  // background grid
  chartCanvas.fillStyle = "rgba(0,0,0,0.15)";
  chartCanvas.fillRect(0,0,w,h);
  // axes lines
  chartCanvas.strokeStyle = 'rgba(0,229,255,0.12)'; chartCanvas.lineWidth=1;
  for(let i=0;i<w;i+=100){ chartCanvas.beginPath(); chartCanvas.moveTo(i,0); chartCanvas.lineTo(i,h); chartCanvas.stroke(); }
  // plot
  chartCanvas.beginPath();
  chartCanvas.strokeStyle = '#9fff6b'; chartCanvas.lineWidth = 2;
  const step = w / Math.max(values.length-1,1);
  values.forEach((v,i)=>{
    const x = i*step;
    const y = h/2 - (v * (h/2 - 20));
    if(i===0) chartCanvas.moveTo(x,y); else chartCanvas.lineTo(x,y);
  });
  chartCanvas.stroke();
}

/* =========== RADAR (animated) =========== */
const radar = q('radarCanvas');
const rctx = radar.getContext('2d');
let radarAngle = 0;
function drawRadar(angleFromServer, intensity){
  const W = radar.width, H = radar.height, cx = W/2, cy = H/2, R = Math.min(W,H)/2 - 6;
  rctx.clearRect(0,0,W,H);
  // concentric
  for(let i=1;i<=4;i++){ rctx.beginPath(); rctx.strokeStyle = `rgba(0,229,255,${0.06*i})`; rctx.arc(cx,cy,R*i/4,0,Math.PI*2); rctx.stroke(); }
  // sweeping beam
  radarAngle += 0.02;
  const sweep = radarAngle;
  const grad = rctx.createRadialGradient(cx,cy,cx*0.1,cx,cy,R);
  grad.addColorStop(0, "rgba(0,229,255,0.25)");
  grad.addColorStop(1, "rgba(0,229,255,0)");
  rctx.fillStyle = grad;
  rctx.beginPath();
  rctx.moveTo(cx,cy);
  rctx.arc(cx,cy,R,sweep-0.3,sweep, false);
  rctx.closePath();
  rctx.fill();
  // satellite dot from server angle
  const satX = cx + Math.cos((angleFromServer||0) * Math.PI/180) * (R*0.72);
  const satY = cy + Math.sin((angleFromServer||0) * Math.PI/180) * (R*0.72);
  rctx.fillStyle = 'rgba(155,89,182,1)';
  rctx.beginPath(); rctx.arc(satX,satY,6,0,Math.PI*2); rctx.fill();
}

/* =========== LIVE FETCH & updates =========== */
async function fetchSignals(){
  try {
    const res = await fetch(backendURL + '/api/signal');
    return await res.json();
  } catch(e){ console.error(e); return null; }
}
async function fetchRadar(){ try { return await (await fetch(backendURL + '/api/radar')).json(); } catch(e){return null;} }
async function fetchBroker(){ try { return await (await fetch(backendURL + '/api/broker')).json(); } catch(e){return null;} }

let liveInterval;
async function startLive(){
  // initial fetch
  const sig = await fetchSignals();
  if(sig && sig.signals) drawChart(sig.signals);
  const rd = await fetchRadar(); if(rd) drawRadar(rd.angle, rd.intensity);
  const bk = await fetchBroker(); if(bk){
    q('aiCore').innerHTML = `<h3>AI Core<br><small style="font-weight:600;color:#bff">${bk.broker}</small><br>Bal:${bk.balance}</h3>`;
  }
  // looping
  liveInterval = setInterval(async ()=>{
    const s = await fetchSignals(); if(s && s.signals) drawChart(s.signals);
    const r = await fetchRadar(); if(r) drawRadar(r.angle, r.intensity);
    const b = await fetchBroker(); if(b){ q('aiCore').innerHTML = `<h3>AI Core<br><small style="font-weight:600;color:#bff">${b.broker}</small><br>Bal:${b.balance}</h3>`; }
  }, 2000);
}
window.onload = () => { startLive(); };

/* =========== Chat send (simple) =========== */
async function sendChat(){
  const txt = q('chatInput').value.trim(); if(!txt) return;
  logChat(`<div><b style="color:#9be3ff">[YOU]</b> ${txt}</div>`);
  q('chatInput').value='';
  try{
    const res = await fetch(backendURL + '/api/chat', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({text:txt})});
    const j = await res.json();
    logChat(`<div><b style="color:#ffd56b">[AI]</b> ${j.reply}</div>`);
  }catch(e){ logChat(`<div><b style="color:#ff6b6b">[ERR]</b> chat fail</div>`); }
}

/* =========== UI actions =========== */
function toggleChart(){ q('chartBox').classList.toggle('open'); }
</script>
</body>
</html>
